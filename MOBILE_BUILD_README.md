# KudiManager Mobile Build Guide

## Overview
KudiManager is a progressive web app (PWA) converted to native Android and iOS apps using Capacitor for app store distribution.

## Prerequisites
- Node.js 18+ installed
- Java Development Kit (JDK) 11+ for Android
- Xcode 14+ for iOS
- Capacitor CLI: `npm install -g @capacitor/cli`

## Project Structure
```
kudimanager/
├── client/              # Web app (React + TypeScript)
│   ├── src/
│   ├── public/
│   ├── dist/            # Production build (after npm run build)
│   ├── capacitor.config.ts  # Capacitor configuration
│   └── package.json
├── server/              # Backend API (Express)
├── PRIVACY_POLICY.md    # App store privacy policy
├── TERMS_OF_SERVICE.md  # App store terms
└── APP_STORE_DESCRIPTION.md # Store listing content
```

## Setup Steps

### 1. Install Dependencies
```bash
cd client
npm install
npm install @capacitor/core @capacitor/cli @capacitor/android @capacitor/ios
```

### 2. Build Web App
```bash
npm run build
```
This creates the `dist/` folder that Capacitor will package.

### 3. Initialize Capacitor (if not done)
```bash
npx cap init
# OR use existing config: npx cap init --web-dir dist
```

### 4. Add Platforms
```bash
npx cap add android
npx cap add ios
```

## Android Build

### Prerequisites
- Android Studio installed
- Android SDK Platform 33+ 
- ANDROID_HOME environment variable set

### Build Steps
```bash
# Sync project files
npx cap sync android

# Update web files after changes
npx cap copy android

# Open Android Studio
npx cap open android
```

In Android Studio:
1. Click "Build" → "Build Bundle(s) / APK(s)" → "Build APK(s)"
2. Navigate to `app/build/outputs/apk/release/`
3. Test APK on devices/emulator
4. For Play Store, build AAB: "Build" → "Build Bundle(s) / APK(s)" → "Build Bundle(s)"

### Test Locally
```bash
# Install on connected device
adb install android/app/build/outputs/apk/debug/app-debug.apk

# Or enable USB debugging and test from Android Studio
```

## iOS Build

### Prerequisites
- Xcode Command Line Tools: `xcode-select --install`
- CocoaPods: `sudo gem install cocoapods`
- Apple Developer Account

### Build Steps
```bash
# Sync project files
npx cap sync ios

# Update web files after changes
npx cap copy ios

# Open Xcode
npx cap open ios
```

In Xcode:
1. Select "KudiManager" project in Project Navigator
2. Go to "Signing & Capabilities" tab
3. Set Team ID and Bundle Identifier
4. Connect iPhone or select simulator
5. Click "Product" → "Build" (⌘B)
6. Click "Product" → "Run" (⌘R) to test

### Archive for App Store
1. In Xcode: "Product" → "Archive"
2. Click "Distribute App" in Organizer
3. Select "App Store Connect"
4. Follow Apple's submission process

## App Icons & Splash Screens

### Icon Requirements
- **Master Icon**: 1024×1024px PNG (transparent background)
- **Android**: Icons at 192px, 512px required (generated by Capacitor)
- **iOS**: Icons at 180px, 120px required (generated by Capacitor)

### Generate Icons
```bash
# Capacitor auto-generates from a master icon
# Place at: client/public/app-icon.png (512×512px minimum)

npx cap update  # Regenerates icons
```

### Splash Screen
- **Image**: 2732×2732px PNG (or larger)
- **Location**: `android/app/src/main/res/drawable/splash.png`
- **Color**: #007F5F (KudiManager emerald green)
- **Capacitor Config**: Uses `SplashScreen` plugin in `capacitor.config.ts`

## Environment Configuration

### Production Build
```bash
# Set production environment
export NODE_ENV=production

# Build web app
cd client && npm run build

# Verify dist/ folder exists with all files
ls -la dist/

# Sync to mobile platforms
npx cap sync
```

### API Configuration
Update `capacitor.config.ts` server settings:
```typescript
server: {
  url: 'https://api.kudimanager.com',  // Production API
  cleartext: false  // HTTPS required in production
}
```

## Testing Checklist

### Before App Store Submission
- [ ] All features tested on real devices (Android 11+, iOS 14+)
- [ ] Payment flow tested (Paystack, Flutterwave)
- [ ] Offline functionality verified
- [ ] App performance optimized (< 3s load time)
- [ ] No console errors or crashes
- [ ] All translations verified
- [ ] Privacy Policy accessible in app
- [ ] Terms of Service accessible
- [ ] Contact/support information provided

### Android Testing
- [ ] Tested on minimum API level (API 21+)
- [ ] Tested on latest API level
- [ ] Portrait and landscape modes work
- [ ] Back button navigation works
- [ ] Permissions requested properly

### iOS Testing
- [ ] Tested on iOS 14+ and latest iOS
- [ ] Safe area respected (notches, home indicator)
- [ ] Dark mode support verified
- [ ] All touches and gestures working

## Deployment

### Android Play Store
1. Create Google Play Developer account ($25 one-time)
2. Prepare store assets:
   - Icon (512×512px PNG)
   - Screenshots (5-8 images per orientation)
   - Feature graphic (1024×500px)
3. Generate signed release APK/AAB
4. Upload AAB to Play Console
5. Submit for review (24-48 hours)

### Apple App Store
1. Enroll in Apple Developer Program ($99/year)
2. Create app in App Store Connect
3. Prepare assets:
   - Icons (1024×1024px)
   - Screenshots (all device sizes)
   - Demo video (optional)
4. Archive app in Xcode
5. Upload via Transporter or Xcode
6. Submit for review (1-3 days)

## Troubleshooting

### White Screen on Launch
- Check web build: `npm run build`
- Verify `capacitor.config.ts` webDir points to `dist/`
- Clear cache: `npx cap clean`

### Build Failures
- Update Capacitor: `npm install @capacitor/core@latest`
- Sync project: `npx cap sync`
- Check Node version: `node --version` (should be 18+)

### Payment Integration Issues
- Verify Paystack keys in environment
- Test webhook endpoints
- Check CORS headers

### Performance Issues
- Optimize images (use WebP)
- Lazy load components
- Use production build
- Check bundle size: `npm run build` shows sizes

## Support

For issues:
1. Check Capacitor docs: https://capacitorjs.com
2. Review Android Studio/Xcode logs
3. Contact: support@kudimanager.com

---

**Last Updated**: November 21, 2025
